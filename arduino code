#include <Wire.h>
#include <LiquidCrystal_I2C.h>
LiquidCrystal_I2C lcd(0x27, 20, 4);


#define green1 8
#define orange1 9
#define red1 10
#define green2 4
#define orange2 5
#define red2 6

int oldpassage = 10;
const int buttonPin = 3;
const int buttonPin2 = 2;    
volatile int change = 1;
int mode = 2;
long debouncing_time = 200; 
volatile unsigned long last_micros;
unsigned long previousMillis = 0;
const long interval1 = 500;
const long interval2 = 500;
unsigned long currentMillis;
volatile int i1 = 0;
volatile int i2 = 0;
volatile int passage = 0;
int set_red = 1;

int array_day[8][6] = {{0,0,1,0,0,1},
                 {0,1,1,0,0,1},
                 {1,0,0,0,0,1},
                 {1,0,0,0,0,1},
                 {0,1,0,0,0,1},
                 {0,0,1,0,1,1},
                 {0,0,1,1,0,0},
                 {0,0,1,0,1,0}};

                      
 int array_night[6][6] = {{0,1,0,0,1,0},
                     {0,0,0,0,0,0},
                     {0,1,0,0,1,0},
                     {0,0,0,0,0,0},
                     {0,1,0,0,1,0},
                     {0,0,0,0,0,0}};             
 

void setup() {
    lcd.begin();
    lcd.backlight();
    Serial.begin(9600);
    pinMode(green1, OUTPUT);
    pinMode(orange1, OUTPUT);
    pinMode(red1, OUTPUT);
    pinMode(green2, OUTPUT);
    pinMode(orange2, OUTPUT);
    pinMode(red2, OUTPUT);
    pinMode(buttonPin, INPUT);
    attachInterrupt(digitalPinToInterrupt(buttonPin), debounce, RISING);
    attachInterrupt(digitalPinToInterrupt(buttonPin2), car, RISING);

}

void loop(){
   vypis();
   
  while (mode == 1){
     day();  
  }
  
  while (mode == 2){
     noc();     
   } 
}

void vypis (){
  if (mode = 1){
   Serial.println("day");
   lcd.clear();
   lcd.setCursor(0, 0);
   lcd.print("day");
   delay (1000);
 }
}

void debounce(){

 if((long)(micros() - last_micros) >= debouncing_time * 1000) {
    change = 1;
    i2 = 0;
    passage = 0;
    last_micros = micros();
   }
}

void car(){

 if((long)(micros() - last_micros) >= debouncing_time * 1000) {
    passage++;
    i1 = 0;
    last_micros = micros();
   }
}

void day(){
   if (change == 1){
      if (mode < 2){
          mode++;
       }
      else{
         mode = 1;   
        }
        change = 0;
   
      }

      currentMillis = millis();
    if (currentMillis - previousMillis >= interval1) {    
        previousMillis = currentMillis;
              digitalWrite(green1,array_day[i1][0]);
              digitalWrite(orange1,array_day[i1][1]);
              digitalWrite(red1,array_day[i1][2]);
              digitalWrite(green2,array_day[i1][3]);
              digitalWrite(orange2,array_day[i1][4]);
              digitalWrite(red2,array_day[i1][5]);

              if (i1<7){
                i1++;
              }
              else{
                i1=1;
              }          
   }
}

void noc(){
   if ((oldpassage!=passage) && (mode==2)){
   Serial.print("Projelo aut: ");
   Serial.println(passage);
   Serial.println("noc");
   oldpassage = passage;
   }
   if (passage == 5){
      if (mode < 2){
          mode++;
       }
      else{
         mode = 1;   
        }
   }
    currentMillis = millis();
    if (currentMillis - previousMillis >= interval2) {    
        previousMillis = currentMillis;
              digitalWrite(green1,array_night[i2][0]);
              digitalWrite(orange1,array_night[i2][1]);
              digitalWrite(red1,array_night[i2][2]);
              digitalWrite(green2,array_night[i2][3]);
              digitalWrite(orange2,array_night[i2][4]);
              digitalWrite(red2,array_night[i2][5]);

              if (i2<5){
                i2++;
              }
              else{
                i2=4;
              }              
     }

}
